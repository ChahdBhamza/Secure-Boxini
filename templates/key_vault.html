<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Key Vault - SecureBoxini</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-slate-50 min-h-screen">
    <!-- Header -->
    <header class="border-b border-slate-800/50 bg-slate-900/30 backdrop-blur-xl sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-400 to-cyan-400 flex items-center justify-center">
                        <svg class="w-6 h-6 text-slate-950" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3v-6">
                            </path>
                        </svg>
                    </div>
                    <h1
                        class="text-xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">
                        SecureBoxini</h1>
                </div>
                <nav class="flex items-center gap-6">
                    <a href="{{ url_for('dashboard') }}"
                        class="text-sm text-slate-400 hover:text-white transition-colors font-medium">Dashboard</a>
                    <a href="{{ url_for('key_vault_dashboard') }}"
                        class="text-sm text-slate-400 hover:text-white transition-colors font-medium">Key Vault</a>
                    <a href="{{ url_for('profile') }}"
                        class="text-sm text-slate-400 hover:text-white transition-colors font-medium">Profile</a>
                    <a href="{{ url_for('logout') }}"
                        class="text-sm text-slate-400 hover:text-red-400 px-4 py-2 rounded-lg hover:bg-slate-800/50 transition-all font-medium">
                        Logout
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-12">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="mb-8 space-y-2" id="flashMessages">
            {% for category, message in messages %}
            <div
                class="p-4 rounded-xl border {% if category == 'error' %}bg-red-500/10 border-red-500/20 text-red-400{% else %}bg-green-500/10 border-green-500/20 text-green-400{% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        <script>
            // Auto-hide flash messages after 2 seconds
            setTimeout(() => {
                const flashMessages = document.getElementById('flashMessages');
                if (flashMessages) {
                    flashMessages.style.transition = 'opacity 0.5s';
                    flashMessages.style.opacity = '0';
                    setTimeout(() => flashMessages.remove(), 500);
                }
            }, 2000);
        </script>
        {% endif %}
        {% endwith %}

        <h1 class="text-3xl font-bold text-white mb-8 flex items-center gap-3">
            <svg class="w-8 h-8 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z">
                </path>
            </svg>
            My Key Vault
        </h1>

        <div class="grid md:grid-cols-2 gap-8">
            <!-- Add Secret Form -->
            <div class="bg-slate-900 border border-slate-800 rounded-xl p-6">
                <h2 class="text-xl font-semibold text-white mb-4">Store New Secret</h2>
                <form action="{{ url_for('vault_add_secret') }}" method="POST">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-slate-400 mb-2">Secret Name</label>
                        <input type="text" name="name" required placeholder="e.g., API_KEY_GITHUB"
                            class="w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 text-white focus:border-blue-500 focus:outline-none">
                        <p class="text-xs text-slate-500 mt-1">Must be unique.</p>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-medium text-slate-400 mb-2">Secret Value</label>
                        <input type="password" name="value" required placeholder="Your secret value..."
                            class="w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 text-white focus:border-blue-500 focus:outline-none">
                    </div>

                    <button type="submit"
                        class="w-full bg-blue-600 hover:bg-blue-500 text-white font-medium py-2 rounded-lg transition-colors">
                        Encrypt & Store
                    </button>
                </form>
            </div>

            <!-- Secrets List -->
            <div class="bg-slate-900 border border-slate-800 rounded-xl p-6">
                <h2 class="text-xl font-semibold text-white mb-4">Stored Secrets</h2>

                {% if secrets %}
                <div class="space-y-3 max-h-[400px] overflow-y-auto">
                    {% for name in secrets %}
                    <div
                        class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700">
                        <div class="flex items-center gap-3">
                            <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z">
                                </path>
                            </svg>
                            <span class="text-slate-200 font-medium font-mono text-sm">{{ name }}</span>
                        </div>

                        <div class="flex gap-2 items-center">
                            <button onclick="revealSecret('{{ name }}')"
                                class="text-xs bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded transition-colors">
                                Reveal
                            </button>
                            <form action="{{ url_for('vault_delete_secret', name=name) }}" method="POST"
                                onsubmit="return confirm('Are you sure you want to permanently delete this secret?');"
                                style="display: inline;">
                                <button type="submit" class="p-1 text-slate-500 hover:text-red-400 transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                        </path>
                                    </svg>
                                </button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8 text-slate-500">
                    <p>No secrets stored in your vault yet.</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Secret Reveal Modal -->
        <div id="revealModal"
            class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div class="bg-slate-900 border border-slate-700 rounded-xl max-w-lg w-full p-6 shadow-2xl">
                <h3 class="text-lg font-bold text-white mb-2" id="modalSecretName">Wait...</h3>
                <p class="text-slate-400 text-sm mb-4">Decrypting securely from your vault...</p>

                <div
                    class="bg-black rounded-lg p-4 font-mono text-green-400 break-all border border-slate-800 mb-6 relative group">
                    <span id="modalSecretValue">...</span>
                </div>

                <div class="flex justify-end">
                    <button onclick="closeRevealModal()"
                        class="px-4 py-2 text-slate-300 hover:text-white transition-colors">Close</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        async function revealSecret(name) {
            const modal = document.getElementById('revealModal');
            const nameEl = document.getElementById('modalSecretName');
            const valueEl = document.getElementById('modalSecretValue');

            modal.classList.remove('hidden');
            nameEl.textContent = name;
            valueEl.textContent = "Decrypting...";

            try {
                const response = await fetch(`/vault/secret/${name}`);
                const data = await response.json();

                if (data.error) {
                    valueEl.textContent = "Error: " + data.error;
                    valueEl.classList.add('text-red-400');
                } else {
                    valueEl.textContent = data.value;
                    valueEl.classList.remove('text-red-400');
                }
            } catch (e) {
                valueEl.textContent = "Network Error";
            }
        }

        function closeRevealModal() {
            document.getElementById('revealModal').classList.add('hidden');
        }
    </script>
</body>

</html>